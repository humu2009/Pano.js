<!DOCTYPE html>
<html>
	<head>
		<title> Pano.js - CSS 3D Example </title>
		<meta charset="utf-8">
		<meta name="author" content="Nayan Suthar, Humu">
		<link rel="styleSheet" href="models/iphone.css">
	</head>


	<body id="documentBox">
		<header id="headerBox">
			<h1>CSS3D + Panorama</h1>
			<p><i>The demo is based on <strong>Nayan Suthar</strong>'s previous work. Picture by <strong>Alexandre Duret-Lutz</strong></i>.</p>
		</header>
		<div id="theContainer">
			<div id="iphoneObject">			
				<figure id="iphoneBody1" class="iphoneBodyC1">
					<canvas id="iScreen" width=206 height=304 style="background:url(./images/screen.jpg); z-index:100;"></canvas>
					<figure id="iStatusBar" style="opacity:0.85; background:url(./images/bar.png); z-index:101;"></figure>
				</figure>
				<figure id="iphoneBody2" class="iphoneBodyC1"></figure>
				<figure id="iphoneBody4" class="iphoneBodyC1"></figure>
				<figure id="iphoneBody6" class="iphoneBodyC1"></figure>				
				<figure id="iphoneBody7" class="iphoneBodyC2"></figure>
				<figure id="iphoneBody8" class="iphoneBodyC2"></figure>
				<figure id="iphoneBody10" class="iphoneBodyC2"></figure>
				<figure id="iphoneBody12" class="iphoneBodyC2"></figure>				
				<figure id="iphoneBody14" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>
				<figure id="iphoneBody16" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>
				<figure id="iphoneBody18" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>		
				<figure id="iphoneBody20" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody22" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody24" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody26" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody28" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody30" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody32" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody34" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody36" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody38" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody40" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody42" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody44" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody46" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody48" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody50" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody52" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody54" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody56" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody58" class="iphoneBodyC4">
					<figure class="blackEdge2"></figure>
				</figure>
				<figure id="iphoneBody60" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>
				<figure id="iphoneBody62" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>
				<figure id="iphoneBody64" class="iphoneBodyC3">
					<figure class="blackEdge1"></figure>
				</figure>				
				<figure id="iphoneBody65" class="iphoneBodyC2"></figure>
				<figure id="iphoneBody67" class="iphoneBodyC2"></figure>
				<figure id="iphoneBody69" class="iphoneBodyC2"></figure>

				<figure id="iphoneBody71" class="iphoneBodyC1"></figure>
				<figure id="iphoneBody72" class="iphoneBodyC1"></figure>
				<figure id="iphoneBody74" class="iphoneBodyC1"></figure>
				<figure id="iphoneBody76" class="iphoneBodyC1">
					<img id="appleLogo" src="images/logo.png" width="0px" height="0px"></img>
					<h1>iPhone</h1>
					<p>Designed by Apple in California Assembled in Chine <br/> Model A1332 EMC 380A FCC ID:BCG-E2380A IC:579C-E2380A</p>
				</figure>	
				<figure id="iMenuButton">
					<figure id="iMenuButtonInside"></figure>
				</figure>
				<figure id="iSpeaker">
					<figure id="iSpeakerInside"></figure>
				</figure>
				<figure id="frontCam">
					<figure id="frontCamInside"></figure>
				</figure>
				<figure id="simBox">
					<figure id="simHoleBox"></figure>
				</figure>
				<div id="ringerButtonBox">
					<figure id="ringerButton1"></figure>
					<figure id="ringerButton2" class="buttonEdge"></figure>
					<figure id="ringerButton3" class="buttonEdge"></figure>
					<figure id="ringerButton4" class="buttonEdge"></figure>
					<figure id="ringerButtonBack"></figure>
				</div>
				<div id="plusButtonBox">
					<figure id="plusButton1" class="buttonTop">
						<figure id="plusSign1"></figure>
						<figure id="plusSign2"></figure>
					</figure>
					<figure id="plusButton2" class="buttonEdge"></figure>
					<figure id="plusButton3" class="buttonEdge"></figure>
					<figure id="plusButton4" class="buttonEdge"></figure>
					<figure id="plusButtonBack"></figure>
				</div>
				<div id="minusButtonBox">
					<figure id="minusButton1" class="buttonTop">
						<figure id="minusSign"></figure>
					</figure>
					<figure id="minusButton2" class="buttonEdge"></figure>
					<figure id="minusButton3" class="buttonEdge"></figure>
					<figure id="minusButton4" class="buttonEdge"></figure>
					<figure id="minusButtonBack"></figure>
				</div>
				<div id="resetButtonBox">
					<figure id="resetButton1" class="buttonTop"></figure>
					<figure id="resetButton2" class="buttonEdge"></figure>
					<figure id="resetButton3" class="buttonEdge"></figure>
					<figure id="resetButton4" class="buttonEdge"></figure>
					<figure id="resetButtonBack"></figure>
				</div>
				<div id="hfJackBox">
					<figure id="hfJack1">
						<figure id="hfJack2">
							<figure id="hfJack3"></figure>
						</figure>
					</figure>
				</div>	
				<div id="bottomSocket"></div>
			</div>
			<div id="shadowContainer">
				<div id="iphoneShadow"></div>
			</div>	
		</div>
		<script type="text/javascript" src="js/pano.js"></script>
		<script type="text/javascript">

			/*
			 *	Create a view using the canvas element and load the given panorama to display.
			 */

			var view = new Pano.View('iScreen', {heading: 160, pitch: 78.75, fov: 60});
			// play a short animation when the panorama is loaded successfully
			view.onLoad = function() {
				view.navigateTo(90, 90, 90, 5000/*milliseconds*/);
			};
			view.load('panoramas/bonlieu.jpg');

			/*
			 *	Pick the correct property name for CSS3 transform. 
			 */

			var css3TransformPropertyName = null;
			if ('WebkitTransform' in document.body.style)
				css3TransformPropertyName = 'WebkitTransform';
			else if ('MozTransform' in document.body.style)
				css3TransformPropertyName = 'MozTransform';
			else if ('OTransform' in document.body.style)
				css3TransformPropertyName = 'OTransform';
			else if ('MsTransform' in document.body.style)
				css3TransformPropertyName = 'MsTransform';
			else if ('transform' in document.body.style)
				css3TransformPropertyName = 'transform';

			/*
			 *	Check whether CSS3 3D transform is available on this browser. In case that the feature 
			 *	is not supported, we can still provide a 2D fallback by hiding some components which 
			 *	cannot be placed correctly in this mode.
			 */
			var support3D =	('WebkitPerspective' in document.body.style) || 
							('MozPerspective' in document.body.style) || 
							('OPerspective' in document.body.style) || 
							('MsPerspective' in document.body.style) || 
							('perspective' in document.body.style);
			if (!support3D) {
				document.getElementById('simBox').style.display = 'none';
				document.getElementById('ringerButtonBox').style.display = 'none';
				document.getElementById('plusButtonBox').style.display = 'none';
				document.getElementById('minusButtonBox').style.display = 'none';
				document.getElementById('resetButtonBox').style.display = 'none';
				document.getElementById('hfJackBox').style.display = 'none';
				document.getElementById('bottomSocket').style.display = 'none';
				document.getElementById('shadowContainer').style.display = 'none';
				document.getElementById('appleLogo').style.display = 'none';
			}

			/*
			 *	Setup mouse control.
			 */

			var buttonStates = {};
			var mousePosition = [0, 0];

			document.addEventListener('mousedown', function(evt) {
				buttonStates[evt.button] = true;
				mousePosition[0] = evt.screenX;
				mousePosition[1] = evt.screenY;
			});

			document.addEventListener('mouseup', function(evt) {
				buttonStates[evt.button] = false;
			});

			document.addEventListener('mouseout', function(evt) {
				buttonStates[evt.button] = false;
			});

			var rotationY = 25;
			var rotationX = 20;
			var inertialRotationY = 0;
			var inertialRotationX = 0;

			document.addEventListener('mousemove', function(evt) {
				if (buttonStates[0]) {
					var rotationDeltaY = (evt.screenX - mousePosition[0]) * 720 / window.innerWidth;
					var rotationDeltaX = -(evt.screenY - mousePosition[1]) * 270 / window.innerHeight;
					if (Math.abs(rotationDeltaY) > Math.abs(inertialRotationY))
						inertialRotationY = rotationDeltaY;
					if (Math.abs(rotationDeltaX) > Math.abs(inertialRotationX))
						inertialRotationX = rotationDeltaX;
					inertialRotationY = clamp(inertialRotationY, -10, 10);
					inertialRotationX = clamp(inertialRotationX, -10, 10);
					rotate();
					mousePosition[0] = evt.screenX;
					mousePosition[1] = evt.screenY;
				}
			});

			function clamp(v, min, max) {
				return Math.max(min, Math.min(max, v));
			}

			function rotate() {
				rotationY += inertialRotationY;
				rotationX = clamp(rotationX + inertialRotationX, -75, 75);
				if (support3D) {
					// rotate the model
					document.getElementById("iphoneObject").style[css3TransformPropertyName] = "rotateY(" + rotationY + "deg) rotateX(" + rotationX + "deg)";
					// rotate the shadow
					document.getElementById("shadowContainer").style[css3TransformPropertyName] = "rotateY(" + rotationY + "deg) rotateX(90deg)";
				}
				inertialRotationY *= 0.95;
				inertialRotationX *= 0.95;
				if (Math.abs(inertialRotationY) > 0.1 || Math.abs(inertialRotationX) > 0.1) {
					setTimeout(rotate, 60);
				}
			}

		</script>
	</body>
</html>